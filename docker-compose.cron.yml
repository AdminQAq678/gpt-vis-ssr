version: '3.8'

services:
  gpt-vis-ssr:
    # 使用包含 cron 的 Dockerfile
    build:
      context: .
      dockerfile: Dockerfile.cron
    image: my-gpt-vis-ssr-cron:v1
    ports:
      - 8084:3000
    volumes:
      - ./images:/app/public/images
      # 可选：映射日志文件到宿主机
      - ./logs:/var/log
    environment:
      - NODE_ENV=production
      - TZ=Asia/Shanghai
      
      # 系统级 Cron 配置
      - ENABLE_CRON=true                  # 是否启用系统级 cron（true/false）
      - MAX_AGE_HOURS=24                  # 保留时长（小时）
      
      # Node.js 应用级清理配置（可以同时启用）
      - CLEANUP_ENABLED=false             # 禁用应用级清理，使用系统级
      
    restart: unless-stopped

# 说明：
# 1. 这个配置文件使用 Dockerfile.cron，集成了系统级 cron job
# 2. 如果只想使用系统级 cron，设置 ENABLE_CRON=true, CLEANUP_ENABLED=false
# 3. 如果只想使用 Node.js 应用级清理，使用原来的 docker-compose.yml
# 4. 也可以同时启用两者（不推荐，会重复清理）

